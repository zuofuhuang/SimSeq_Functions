---
title: "Model evaluations"
author: "Zuofu Huang"
output: html_document
---

```{r message=FALSE, warning=FALSE}
library(tidyverse); library(ggplot2); library(lubridate); library(TraMineR); library(performance)
library(GLMMadaptive); library(pscl); library(gridExtra); library(MASS)
library(clValid); library(clv); library(TraMineRextras); library(simukde)
```


```{r}
# "baseline" sequence
sequences <- read.csv("../Data in use/original_seqs.csv")[,-1]
sequences[is.na(sequences)] <- "N/A"
# imputed_seqs <- read.csv("../Data in use/imputed_seqs.csv")[,-1]
```


```{r}
# TVMC on original sequences
cluster_TVMC <- read.csv("../Data in use/sim_seqs_cluster_TVMC.csv")[,-1]
noCluster_TVMC <- read.csv("../Data in use/sim_seqs_noCluster_TVMC.csv")[,-1]
```


```{r}
# "basic" synthesis on original sequences (cluster/no cluster + order 1/2)
cluster <- read.csv("../Data in use/sim_seqs_cluster.csv")[,-1]
noCluster <- read.csv("../Data in use/sim_seqs_noCluster.csv")[,-1]

cluster_order2 <- read.csv("../Data in use/sim_seqs_cluster_order2.csv")[,-1]
noCluster_order2 <- read.csv("../Data in use/sim_seqs_noCluster_order2.csv")[,-1]
```


```{r}
# "basic" synthesis on imputed sequences (cluster/no cluster + order 1/2)
imputed_cluster <- read.csv("../Data in use/sim_seqs_imputed_cluster.csv")[,2:1441]
imputed_noCluster <- read.csv("../Data in use/sim_seqs_imputed_noCluster.csv")[,2:1441]

imputed_cluster_order2 <- read.csv("../Data in use/sim_seqs_imputed_cluster_order2.csv")[,2:1441]
imputed_noCluster_order2 <- read.csv("../Data in use/sim_seqs_imputed_noCluster_order2.csv")[,2:1441]
```




```{r}
# KDE synthesis on imputed sequences (cluster/no cluster + order 1/2)
imputed_KDE_cluster <- read.csv("../Data in use/sim_seqs_imputed_KDE_cluster.csv")[,2:1441]
imputed_KDE_noCluster <- read.csv("../Data in use/sim_seqs_imputed_KDE_noCluster.csv")[,2:1441]

imputed_KDE_cluster_order2 <- read.csv("../Data in use/sim_seqs_imputed_KDE_cluster_order2.csv")[,2:1441]
imputed_KDE_noCluster_order2 <- read.csv("../Data in use/sim_seqs_imputed_KDE_noCluster_order2.csv")[,2:1441]
```


```{r}
# logspline
imputed_log_cluster <- read.csv("../Data in use/sim_seqs_imputed_log_cluster.csv")[,2:1441]
imputed_log_noCluster <- read.csv("../Data in use/sim_seqs_imputed_log_noCluster.csv")[,2:1441]

imputed_log_cluster_order2 <- read.csv("../Data in use/sim_seqs_imputed_log_cluster_order2.csv")[,2:1441]
imputed_log_noCluster_order2 <- read.csv("../Data in use/sim_seqs_imputed_log_noCluster_order2.csv")[,2:1441]
```


```{r}
# Investigate effect of time window (30min/60min/120min) on imputed KDE sequences
imputed_cluster_30 <- read.csv("../Data in use/sim_seqs_imputed_cluster_30min.csv")[,2:1441]
# imputed_noCluster_30 <- read.csv("../Data in use/sim_seqs_imputed_noCluster_30min.csv")[,2:1441]
# 
imputed_cluster_120 <- read.csv("../Data in use/sim_seqs_imputed_cluster_120min.csv")[,2:1441]
# imputed_noCluster_120 <- read.csv("../Data in use/sim_seqs_imputed_noCluster_120min.csv")[,2:1441]
# 
imputed_cluster_order2_30 <- read.csv("../Data in use/sim_seqs_imputed_cluster_order2_30min.csv")[,2:1441]
# imputed_noCluster_order2_30 <- read.csv("../Data in use/sim_seqs_imputed_noCluster_order2_30min.csv")[,2:1441]
# 
imputed_cluster_order2_120 <- read.csv("../Data in use/sim_seqs_imputed_cluster_order2_120min.csv")[,2:1441]
# imputed_noCluster_order2_120 <- read.csv("../Data in use/sim_seqs_imputed_noCluster_order2_120min.csv")[,2:1441]
```


## Create TramineR objects

```{r message=FALSE, warning=FALSE}
# "baseline" sequences
sequences_T <- seqdef(sequences)
```


```{r message=FALSE, warning=FALSE}
# TVMC on original sequences
cluster_TVMC_T <- seqdef(cluster_TVMC)
noCluster_TVMC_T <- seqdef(noCluster_TVMC)
```


```{r message=FALSE, warning=FALSE}
# "basic" synthesis on original sequences (cluster/no cluster + order 1/2)
cluster_T <- seqdef(cluster)
noCluster_T <- seqdef(noCluster)

cluster_order2_T <- seqdef(cluster_order2)
noCluster_order2_T <- seqdef(noCluster_order2)
```


```{r message=FALSE, warning=FALSE}
# "basic" synthesis on imputed sequences (cluster/no cluster + order 1/2)
imputed_cluster_T <- seqdef(imputed_cluster)
imputed_noCluster_T <- seqdef(imputed_noCluster)

imputed_cluster_order2_T <- seqdef(imputed_cluster_order2)
imputed_noCluster_order2_T <- seqdef(imputed_noCluster_order2)
```


```{r message=FALSE, warning=FALSE}
# KDE synthesis on imputed sequences (cluster/no cluster + order 1/2)
imputed_KDE_cluster_T <- seqdef(imputed_KDE_cluster)
imputed_KDE_noCluster_T <- seqdef(imputed_KDE_noCluster)

imputed_KDE_cluster_order2_T <- seqdef(imputed_KDE_cluster_order2)
imputed_KDE_noCluster_order2_T <- seqdef(imputed_KDE_noCluster_order2)
```


```{r message=FALSE, warning=FALSE}
# logspline on imputed sequences (cluster/no cluster + order 1/2)
imputed_log_cluster_T <- seqdef(imputed_log_cluster)
imputed_log_noCluster_T <- seqdef(imputed_log_noCluster)

imputed_log_cluster_order2_T <- seqdef(imputed_log_cluster_order2)
imputed_log_noCluster_order2_T <- seqdef(imputed_log_noCluster_order2)
```


```{r message=FALSE, warning=FALSE}
# Investigate effect of time window (30min/60min/120min) on imputed sequences
imputed_cluster_30_T <- seqdef(imputed_cluster_30)
# imputed_noCluster_30_T <- seqdef(imputed_noCluster_30)
# 
imputed_cluster_120_T <- seqdef(imputed_cluster_120)
# imputed_noCluster_120_T <- seqdef(imputed_noCluster_120)
# 
imputed_cluster_order2_30_T <- seqdef(imputed_cluster_order2_30)
# imputed_noCluster_order2_30_T <- seqdef(imputed_noCluster_order2_30)
# 
imputed_cluster_order2_120_T <- seqdef(imputed_cluster_order2_120)
# imputed_noCluster_order2_120_T <- seqdef(imputed_noCluster_order2_120)
```


```{r}
sim_list <- list(sequences, cluster_TVMC, noCluster_TVMC, cluster, noCluster, cluster_order2, noCluster_order2, imputed_cluster, imputed_noCluster, imputed_cluster_order2, imputed_noCluster_order2, imputed_KDE_cluster, imputed_KDE_noCluster, imputed_KDE_cluster_order2, imputed_KDE_noCluster_order2, imputed_log_cluster, imputed_log_noCluster, imputed_log_cluster_order2, imputed_log_noCluster_order2)

sim_list_T <- list(sequences_T, cluster_TVMC_T, noCluster_TVMC_T, cluster_T, noCluster_T, cluster_order2_T, noCluster_order2_T, imputed_cluster_T, imputed_noCluster_T, imputed_cluster_order2_T, imputed_noCluster_order2_T, imputed_KDE_cluster_T, imputed_KDE_noCluster_T, imputed_KDE_cluster_order2_T, imputed_KDE_noCluster_order2_T, imputed_log_cluster_T, imputed_log_noCluster_T, imputed_log_cluster_order2_T, imputed_log_noCluster_order2_T)
```

```{r}
sim_list_window <- list(sequences, imputed_cluster, imputed_cluster_order2, imputed_cluster_30, imputed_cluster_order2_30, imputed_cluster_120, imputed_cluster_order2_120)

sim_list_window_T <- list(sequences_T, imputed_cluster_T, imputed_cluster_order2_T, imputed_cluster_30_T, imputed_cluster_order2_30_T, imputed_cluster_120_T, imputed_cluster_order2_120_T)
```


# Tool examples

## Distribution plots

```{r message=FALSE}
### Example:
# sequences[sequences == "N/A"] <- NA
# p_sequences <- seqplot(seqdef(sequences), border = NA, type = "d", cex.legend = 0.5)

this <- as.data.frame(sim_list[[1]])
this[this == "N/A"] <- NA
seqplot(seqdef(this), border = NA, type = "d", cex.legend = 0.5)
```


## Percentage of each activity

```{r}
### Example:
a_sequences <- seqmeant(sequences_T)
```


## Distribution of duration of each activity

```{r}
### Example:
dist_of_activity_dur <- function(traminer_seq){
  dist <- seqistatd(traminer_seq)
  means <- apply(dist, 2, mean)
  sds <- apply(dist, 2, sd)
  return(list(means,sds))
}

# dist1 <- seqistatd(sequences_T)
# c1 <- apply(dist1, 2, mean)
# d1 <- apply(dist1, 2, sd)
```


## The distribution of number of distinct states in each sequence

```{r}
num_of_distinct_states <- function(traminer_seq){
  return(seqlength(seqdss(traminer_seq)))
}
```


## How much work/home does each day have?

```{r}
length_of_certain_activity <- function(traminer_seq, activity){
  dist <- seqistatd(traminer_seq)
  return(dist[,activity])
}

### Example:
# work1 <- dist1[,"WORK"]
```


```{r}
# dat <- as.data.frame(cbind(c(work1, work6, work7, work8, work9, work10, work11), c(rep("Original data",1929),rep("TVMC",1929*2), rep("Our Method",1929*2), rep("Our Method + order 2", 1929*2)), c(rep("Clustered", 1929), rep("Clustered",1929),rep("Not Clustered",1929),rep("Clustered",1929),rep("Not Clustered",1929),rep("Clustered",1929),rep("Not Clustered",1929))))
# 
# colnames(dat) <- c("Length", "Method","Clustered")
# dat$Length <- as.numeric(dat$Length)
```


```{r}
# ggplot(data = dat, aes(x = Length)) +
#   facet_grid(Clustered ~ Method) +
#   geom_histogram(binwidth = 50) +
#   theme_bw()
```

Maybe if the clustering idea is good, we can think of adding the individual level through clustering as well.


## Number of distinct activity periods per day

```{r}
num_distinct_periods_perday <- function(traminer_seq, activity){
  return(table(rowSums(seqdss(traminer_seq) == activity)))
}

### Example:
# work_num1 <- table(rowSums(seqdss(sequences_T) == "WORK"))
```



## Sum of percentage of each state squared

```{r}
# ref and data are traminer objects
sum_of_state_pct <- function(ref, data){
  ref_prob <- seqstatd(ref)[["Frequencies"]]
  data_prob <- seqstatd(data)[["Frequencies"]]
  
  dist <- 0
  for (i in 1:ncol(ref_prob)){
    this_ref <- as.vector(ref_prob[,i])
    this_data <- as.vector(data_prob[,i])
    this_dist <- sum((this_ref - this_data)^2)
    dist <- dist + this_dist
  }
  return(dist)
}


### Example: 
# sum_of_state_pct(sequences_T, cluster_T)
```


## Entropy

```{r}
### Example:
# entropy1 <- TraMineR::seqient(sequences_T)
```


## Transition Matrix?

```{r}
tm1 <- seqtrate(sequences_T)
tm6 <- seqtrate(sim_seqs_cluster_TVMC_T)
tm7 <- seqtrate(sim_seqs_noCluster_TVMC_T)
tm8 <- seqtrate(sim_seqs_imputed_cluster_T)
tm9 <- seqtrate(sim_seqs_imputed_noCluster_T)
tm10 <- seqtrate(sim_seqs_imputed_cluster_order2_T)
tm11 <- seqtrate(sim_seqs_imputed_noCluster_order2_T)
```

```{r}
heatmap(tm1 - tm6, Rowv = NA, Colv = NA)
heatmap(tm1 - tm7, Rowv = NA, Colv = NA)
heatmap(tm1 - tm8, Rowv = NA, Colv = NA)
heatmap(tm1 - tm9, Rowv = NA, Colv = NA)
heatmap(tm1 - tm10, Rowv = NA, Colv = NA)
heatmap(tm1 - tm11, Rowv = NA, Colv = NA)
```


## Durations of each state (to show that they are not exponentially distributed)

```{r}
# find_lengths <- function(seq, state){
#   rled <- rle(seq)
#   lengths <- rled$lengths[which(rled$values == state)]
#   return(lengths)
# }
# 
# works <- unlist(apply(sequences, 1, find_lengths, state = "WORK"))
# homes <- unlist(apply(sequences, 1, find_lengths, state = "HOME"))
# cars <- unlist(apply(sequences, 1, find_lengths, state = "CAR"))
# 
# g1 <- ggplot(data = data.frame(works), aes(x = works)) + 
#   geom_density() +
#   scale_x_continuous(limits = c(0, 1440)) +
#   theme_bw() + 
#   xlab("Duration of work episodes") + 
#   ggtitle("Distribution of work episodes")
# 
# g2 <- ggplot(data = data.frame(homes), aes(x = homes)) + 
#   geom_density() +
#   scale_x_continuous(limits = c(0, 1440)) +
#   theme_bw() + 
#   xlab("Duration of home episodes") + 
#   ggtitle("Distribution of home episodes")
# 
# g3 <- ggplot(data = data.frame(cars), aes(x = cars)) + 
#   geom_density() + 
#   scale_x_continuous(limits = c(0, 1440)) +
#   theme_bw() + 
#   xlab("Duration of car episodes") + 
#   ggtitle("Distribution of car episodes")
#   
# 
# grid.arrange(g1,g2,g3, nrow = 3)
```






# Working playground

Evaluation criteria: 

1. Transition matrix and heatmap? (TO BE DEVELOPED)

2. Distribution of state durations (Mean and SD of each activity)

3. Distribution of number of distinct states (Mean and SD)

4. Distribution of entropies (and K-S test statistic p-value against original sequences)

5. Distribution of daily hours spent on work/home states (and K-S test statistic p-value against original sequences)


```{r}
# for (i in 1:length(sim_list_T)){
#   print(sum(is.na(sim_list_T[[i]])))
# }
```


2. Distribution of state durations (Mean and SD of each activity)

```{r}
this <- lapply(sim_list_T, dist_of_activity_dur)
means <- as.matrix(sapply(this,"[[", 1))
means_prop <- means

for (i in 2:19){
  for (j in 1:13){
    means_prop[j,i] <- paste0(round((means[j,i]/means[j,1] - 1) * 100,1), "%")
  }
}
means <- round(means, 2)
means_prop[,1] <- round(as.vector(as.numeric((means_prop[,1]), 2)), 2)



sds <- as.matrix(sapply(this,"[[", 2))
sds_prop <- sds

for (i in 2:19){
  for (j in 1:13){
    sds_prop[j,i] <- paste0(round((sds[j,i]/sds[j,1] - 1) * 100,1), "%")
  }
}
sds <- round(sds, 2)
sds_prop[,1] <- round(as.vector(as.numeric((sds_prop[,1]), 2)), 2)
```

```{r}
result <- la

for(i in 1:nrow(la)){
  for (j in 1:ncol(la)){
    result[i,j] <- paste0(la[i,j], " (", la_sd[i,j],")")
  }
}

write.csv(data.frame(result),"result.csv")
```



3. Distribution of number of distinct states (Mean and SD)

```{r}
dists <- lapply(sim_list_T, num_of_distinct_states)

means <- sapply(dists, mean)
round(means, 2)
sds <- sapply(dists, sd)
round(sds, 2)
```


4. Distribution of entropies (and K-S test statistic p-value against original sequences)

```{r}
entropies <- lapply(sim_list_T, TraMineR::seqient)

pvalues <- c()
for (i in 2:19){
  pvalues <- c(pvalues, ks.test(entropies[[1]], entropies[[i]])$p.value)
}

# pvalues
```

```{r}
# Consider plots
entropy_dat <- as.data.frame(cbind(c(entropies[[1]], entropies[[2]], entropies[[3]], entropies[[8]], entropies[[9]], entropies[[10]], entropies[[11]]), c(rep("Original data",1929),rep("TVMC",1929*2), rep("Paired-MC order 1",1929*2), rep("Paired-MC order 2", 1929*2)), c(rep("Clustered", 1929), rep("Clustered",1929),rep("Not Clustered",1929),rep("Clustered",1929),rep("Not Clustered",1929),rep("Clustered",1929),rep("Not Clustered",1929))))

colnames(entropy_dat) <- c("Length", "Method", "Clustered")
entropy_dat$Length <- as.numeric(entropy_dat$Length)
entropy_dat$Method <- factor(entropy_dat$Method, levels = c("Original data","TVMC","Paired-MC order 1", "Paired-MC order 2"))

ggplot(data = entropy_dat, aes(x = Length)) +
  facet_grid(Clustered ~ Method) +
  geom_histogram(binwidth = 0.02) +
  theme_bw()
```


## 5. Distribution of daily hours spent on work/home states (and K-S test statistic p-value against original sequences)

### **WORK**

```{r}
dists <- lapply(sim_list_T, length_of_certain_activity, activity = "WORK")

pvalues_work <- c()
for (i in 2:19){
  pvalues_work <- c(pvalues_work, ks.test(dists[[1]], dists[[i]])$p.value)
}

# pvalues_work

work_dist_dat <- as.data.frame(cbind(c(dists[[1]], dists[[2]], dists[[3]], dists[[8]], dists[[9]], dists[[10]], dists[[11]]), c(rep("Original data",1929),rep("TVMC",1929*2), rep("Paired-MC order 1",1929*2), rep("Paired-MC order 2", 1929*2)), c(rep("Clustered", 1929), rep("Clustered",1929),rep("Not Clustered",1929),rep("Clustered",1929),rep("Not Clustered",1929),rep("Clustered",1929),rep("Not Clustered",1929))))

colnames(work_dist_dat) <- c("Length", "Method", "Clustered")
work_dist_dat$Length <- as.numeric(work_dist_dat$Length)
work_dist_dat$Method <- factor(work_dist_dat$Method, levels = c("Original data","TVMC","Paired-MC order 1", "Paired-MC order 2"))

ggplot(data = work_dist_dat, aes(x = Length)) +
  facet_grid(Clustered ~ Method) +
  geom_histogram(binwidth = 30) +
  theme_bw()

ggplot(data = work_dist_dat[work_dist_dat$Length != 0,], aes(x = Length)) +
  facet_grid(Clustered ~ Method) +
  geom_histogram(binwidth = 30) +
  theme_bw()
```




### **HOME**

```{r}
dists_home <- lapply(sim_list_T, length_of_certain_activity, activity = "HOME")

pvalues_home <- c()
for (i in 2:19){
  pvalues_home <- c(pvalues_home, ks.test(dists_home[[1]], dists_home[[i]])$p.value)
}

# pvalues_home

home_dist_dat <- as.data.frame(cbind(c(dists_home[[1]], dists_home[[2]], dists_home[[3]], dists_home[[8]], dists_home[[9]], dists_home[[10]], dists_home[[11]]), c(rep("Original data",1929),rep("TVMC",1929*2), rep("Paired-MC order 1",1929*2), rep("Paired-MC order 2", 1929*2)), c(rep("Clustered", 1929), rep("Clustered",1929),rep("Not Clustered",1929),rep("Clustered",1929),rep("Not Clustered",1929),rep("Clustered",1929),rep("Not Clustered",1929))))

colnames(home_dist_dat) <- c("Length", "Method", "Clustered")
home_dist_dat$Length <- as.numeric(home_dist_dat$Length)
home_dist_dat$Method <- factor(home_dist_dat$Method, levels = c("Original data","TVMC","Paired-MC order 1", "Paired-MC order 2"))

ggplot(data = home_dist_dat, aes(x = Length)) +
  facet_grid(Clustered ~ Method) +
  geom_histogram(binwidth = 30) +
  theme_bw()

ggplot(data = home_dist_dat[home_dist_dat$Length != 1440,], aes(x = Length)) +
  facet_grid(Clustered ~ Method) +
  geom_histogram(binwidth = 30) +
  theme_bw()
```



### **CAR**

```{r}
dists_car <- lapply(sim_list_T, length_of_certain_activity, activity = "CAR")

pvalues_car <- c()
for (i in 2:19){
  pvalues_car <- c(pvalues_car, ks.test(dists_car[[1]], dists_car[[i]])$p.value)
}

pvalues_car

car_dist_dat <- as.data.frame(cbind(c(dists_car[[1]], dists_car[[2]], dists_car[[3]], dists_car[[8]], dists_car[[9]], dists_car[[10]], dists_car[[11]]), c(rep("Original data",1929),rep("TVMC",1929*2), rep("Paired-MC order 1",1929*2), rep("Paired-MC order 2", 1929*2)), c(rep("Clustered", 1929), rep("Clustered",1929),rep("Not Clustered",1929),rep("Clustered",1929),rep("Not Clustered",1929),rep("Clustered",1929),rep("Not Clustered",1929))))

colnames(car_dist_dat) <- c("Length", "Method", "Clustered")
car_dist_dat$Length <- as.numeric(car_dist_dat$Length)
car_dist_dat$Method <- factor(car_dist_dat$Method, levels = c("Original data","TVMC","Paired-MC order 1", "Paired-MC order 2"))

ggplot(data = car_dist_dat, aes(x = Length)) +
  facet_grid(Clustered ~ Method) +
  geom_histogram(binwidth = 5) +
  theme_bw()
```


### **Leisure and recreation**

```{r}
dists_LR <- lapply(sim_list_T, length_of_certain_activity, activity = "LEISURE_RECREATION")

pvalues_LR <- c()
for (i in 2:19){
  pvalues_LR <- c(pvalues_LR, ks.test(dists_LR[[1]], dists_LR[[i]])$p.value)
}

pvalues_LR

LR_dist_dat <- as.data.frame(cbind(c(dists_LR[[1]], dists_LR[[2]], dists_LR[[3]], dists_LR[[8]], dists_LR[[9]], dists_LR[[10]], dists_LR[[11]]), c(rep("Original data",1929),rep("TVMC",1929*2), rep("Paired-MC order 1",1929*2), rep("Paired-MC order 2", 1929*2)), c(rep("Clustered", 1929), rep("Clustered",1929),rep("Not Clustered",1929),rep("Clustered",1929),rep("Not Clustered",1929),rep("Clustered",1929),rep("Not Clustered",1929))))

colnames(LR_dist_dat) <- c("Length", "Method", "Clustered")
LR_dist_dat$Length <- as.numeric(LR_dist_dat$Length)
LR_dist_dat$Method <- factor(LR_dist_dat$Method, levels = c("Original data","TVMC","Paired-MC order 1", "Paired-MC order 2"))
# 
# ggplot(data = LR_dist_dat, aes(x = Length)) +
#   facet_grid(Clustered ~ Method) +
#   geom_histogram(binwidth = 30) +
#   theme_bw()

ggplot(data = LR_dist_dat[LR_dist_dat$Length != 0,], aes(x = Length)) +
  facet_grid(Clustered ~ Method) +
  geom_histogram(binwidth = 20) +
  theme_bw()
```


### **Personal Business**


```{r}
dists_PB <- lapply(sim_list_T, length_of_certain_activity, activity = "PERSONAL_BUSINESS")

pvalues_PB <- c()
for (i in 2:19){
  pvalues_PB <- c(pvalues_PB, ks.test(dists_PB[[1]], dists_PB[[i]])$p.value)
}

pvalues_PB

PB_dist_dat <- as.data.frame(cbind(c(dists_PB[[1]], dists_PB[[2]], dists_PB[[3]], dists_PB[[8]], dists_PB[[9]], dists_PB[[10]], dists_PB[[11]]), c(rep("Original data",1929),rep("TVMC",1929*2), rep("Paired-MC order 1",1929*2), rep("Paired-MC order 2", 1929*2)), c(rep("Clustered", 1929), rep("Clustered",1929),rep("Not Clustered",1929),rep("Clustered",1929),rep("Not Clustered",1929),rep("Clustered",1929),rep("Not Clustered",1929))))

colnames(PB_dist_dat) <- c("Length", "Method", "Clustered")
PB_dist_dat$Length <- as.numeric(PB_dist_dat$Length)
PB_dist_dat$Method <- factor(PB_dist_dat$Method, levels = c("Original data","TVMC","Paired-MC order 1", "Paired-MC order 2"))

ggplot(data = PB_dist_dat[PB_dist_dat$Length != 0,], aes(x = Length)) +
  facet_grid(Clustered ~ Method) +
  geom_histogram(binwidth = 20) +
  theme_bw()
```



Others: 

Sum of percentage of each state at each time squared

```{r}
sapply(sim_list_T, sum_of_state_pct, ref = sequences_T)
```



```{r}
num_distinct_periods_perday(sim_list_T[[19]], "WORK")
```



